<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <title>BCG Thermostat</title><!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="css/bootstrap-theme.min.css" type="text/css"><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <!-- Jquery -->

  <script src="js/jquery-2.1.1.min.js" type="text/javascript">
</script><!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->

  <script src="js/jquery.knob.min.js" type="text/javascript">
</script>
</head>

<body>

<div class="container-fluid"  id="thermostat-datatable">
    <div class="panel panel-info">
      <div class="panel-heading">
        <h4 class="panel-title" id="app-heading">Team status<span id="teamname"></span></h4>
      </div>
      
      <div class="panel-body">
  <table id="dataTable" class="table table-striped">
  <thead>
    <tr>
      <th>Core ID</th>

      <th>Team Name</th>

      <th>Team ID</th>

      <th>Stage 1</th>

      <th>Stage 2</th>

      <th>Stage 3</th>

      <th>Stage 4</th>

      <th>Stage 5</th>
    </tr>
    </thead>
  </table><br>
  <br>
  <script src="js/spark.min.js" type="text/javascript">
</script><script type="text/javascript">
</script><button id="connectbutton" onclick="start()">Connect</button> <script type="text/javascript">



document.body.style.marginTop = "10px";


    function start(objButton) {
        document.getElementById("connectbutton").innerHTML = "Running";
        var eventName = 'bcg-status';
        var accessToken = "c9ee389bd9ae4a38ac022c0269eb386d0696f194";
       var requestURL = "https://api.spark.io/v1/events/?access_token=" + accessToken;

        var eventSource = new EventSource(requestURL);

        eventSource.addEventListener('open', function(e) {
            console.log("Opened!"); },false);

        eventSource.addEventListener('error', function(e) {
            console.log("Errored!"); },false);

        eventSource.addEventListener(eventName, function(e) {
            var parsedData = JSON.parse(e.data);
            
            
             var innerData = JSON.parse(parsedData.data);
   // wstream.write(parsedData.coreid + ',' + parsedData.published_at + ',' + innerData.id + "," + innerData.team + "," + innerData.bcg_status + '\n');
    
            
            
           var dt = document.getElementById("dataTable");
            var rows = dt.rows.length;
           var foundIt = false;
           for(var i=0;i<rows;i++) {
             var rowN = dt.rows[i];
             if (false==foundIt  && rowN.cells[0].innerHTML==parsedData.coreid) {
               foundIt = true;
               rowN.cells[1].innerHTML = innerData.team;
               rowN.cells[2].innerHTML = innerData.id;
               
               if (innerData.bcg_status == 'step1') {
                       if(rowN.cells[3].innerHTML == "") {
                               rowN.cells[3].innerHTML = parsedData.published_at; 
                       }
               } else if (innerData.bcg_status == 'step2') {
                       if(rowN.cells[4].innerHTML == "") {
                               rowN.cells[4].innerHTML = parsedData.published_at; 
                       }
               } else if (innerData.bcg_status == 'step3') {
                       if(rowN.cells[5].innerHTML == "") {
                               rowN.cells[5].innerHTML = parsedData.published_at; 
                       }
               } else if (innerData.bcg_status == 'step4') {
                       if(rowN.cells[6].innerHTML == "") {
                               rowN.cells[6].innerHTML = parsedData.published_at; 
                       }
               } else if (innerData.bcg_status == 'step5') {
                       if(rowN.cells[7].innerHTML == "") {
                               rowN.cells[7].innerHTML = parsedData.published_at; 
                       }
               } 
               
       
             }
           }
           if (false == foundIt) {
             var newRow = dt.insertRow(rows);
              var cell1 = newRow.insertCell(0);
              var cell2 = newRow.insertCell(1);
              var cell3 = newRow.insertCell(2);
              var cell4 = newRow.insertCell(3);
              var cell5 = newRow.insertCell(4);
              var cell6 = newRow.insertCell(5);
              var cell7 = newRow.insertCell(6);
		      var cell8 = newRow.insertCell(7);
                     
             cell1.innerHTML = parsedData.coreid;
             cell2.innerHTML = innerData.team;
             cell3.innerHTML = innerData.id;
             
             
             if (innerData.bcg_status == 'step1') {
                       if(cell4.innerHTML == "") {
                               cell4.innerHTML = parsedData.published_at; 
                       }
               } else if (innerData.bcg_status == 'step2') {
                       if(cell5.innerHTML == "") {
                               cell5.innerHTML = parsedData.published_at; 
                       }
               } else if (innerData.bcg_status == 'step3') {
                       if(cell6.innerHTML == "") {
                               cell6.innerHTML = parsedData.published_at; 
                       }
               } else if (innerData.bcg_status == 'step4') {
                       if(cell7.innerHTML == "") {
                               cell7.innerHTML = parsedData.published_at; 
                       }
               } else if (innerData.bcg_status == 'step5') {
                       if(cell8.innerHTML == "") {
                               cell8.innerHTML = parsedData.published_at; 
                       }
               } 
             
             
           }

        }, false);
    }
  </script>
  
  </div></div>
</body>
</html>
